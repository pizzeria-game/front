<script setup lang="ts">
import PizzaBox from "@/components/PizzaBox.vue"
import { onMounted, ref, watch } from "vue"

type itemsType = {
    id: number
    item: string
    positionX: number
    size: number
    delay: number
}

const items = ref<itemsType[]>([])
const score = ref(0)
const isScoreChanged = ref(false)

const generateRandomItem = () => {
    const items = ["🍅", "🧅", "🍄", "🍍", "🍟", "🍗", "🥓", "🥩", "🍖", "🥪", "🥫", "🥚", "🍳"]
    const numbersOfItems = Math.floor(Math.random() * 20) + 10
    const randomItems = []
    let cumulativeDelay = 0.5
    for (let i = 0; i < numbersOfItems; i++) {
        const randomIndex = Math.floor(Math.random() * items.length)
        randomItems.push({
            id: i,
            item: items[randomIndex],
            positionX: Math.floor(Math.random() * 95) + 1,
            size: Math.floor(Math.random() * 50) + 20,
            delay: cumulativeDelay
        })
        cumulativeDelay += Math.random() * 1.5 + 1.5
    }
    return randomItems
}

onMounted(() => {
    items.value = generateRandomItem()

    // Watch for changes in the score and trigger the visual effect
    watch(
        () => score.value,
        () => {
            isScoreChanged.value = true
            // Reset the flag after a short delay
            setTimeout(() => {
                isScoreChanged.value = false
            }, 500)
        }
    )
})

const onTouchItem = (item_id: number) => {
    const item = items.value.find((item) => item.id === item_id)
    if (!item) return

    items.value = items.value.filter((item) => item.id !== item_id)
    score.value += 1
}
</script>

<template>
    <PizzaBox :onTouchItem="onTouchItem" />
    <div class="items">
        <div
            v-for="item in items"
            :key="item.id"
            class="item"
            :style="{ fontSize: `${item.size}px`, left: `${item.positionX}%`, animationDelay: `${item.delay}s` }"
            :data-id="item.id"
        >
            {{ item.item }}
        </div>
    </div>
    <p
        class="score"
        :class="{ 'score-changed': isScoreChanged }"
        :style="{ fontSize: `${14 + Math.floor(score / 5) * 2}px` }"
    >
        Score: {{ score }}
    </p>
</template>

<style scoped>
.items {
    position: relative;
    width: 100vw;
    height: 100vh;
    display: block;
}
.item {
    position: absolute;
    animation: fall 10s ease-in-out;
    transform: translateY(-150px);
}

.score {
    position: absolute;
    bottom: 0px;
    left: 50%;
    transform: translateX(-50%);
    padding: 5px;
    /* transition: color 0.5s ease;  */
}

.score-changed {
    color: green; /* Change color when the score changes */
}

@keyframes fall {
    to {
        transform: translateY(110vh) rotate(360deg);
    }
}
</style>
